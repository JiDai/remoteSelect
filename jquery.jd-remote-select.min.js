/*

Remote Select form plugin
Copyright Â© 2012 Jordi Dosne
http://www.dosne.net

Requires jQuery 1.4 or newer
Requires jQuery Metadata

Allow to a select form to get json data.

Enjoy!

*/(function(a){a.jdRemoteSelect={defaults:{keepFirstOption:!1,keepLastOption:!1,subSelect:null,labelProperty:"label",valueProperty:"id",autoLoad:!0,defaultValue:"",data:{}},elements:[]};var b={init:function(c){return this.each(function(){var d=a(this);if(d.metadata===undefined)throw new Error("jQuery Metadata must be imported");if(!a.data(this,"jdRemoteSelectParams")){var e=a.parseJSON(d.attr("data-remote-select")),f=a.extend({},a.jdRemoteSelect.defaults,e,c);f.data.method="get";f.subSelectTarget!==undefined&&f.subSelectTarget!==""?f.subSelect=a(f.subSelectTarget):f.subSelect=null;a.data(this,"jdRemoteSelectParams",f);if(f.data.url===undefined||f.data.url==="")return;f.autoLoad===!0&&b.loadData.apply(d,[]);f=null}})},loadData:function(){var c=this,d=a.data(c[0],"jdRemoteSelectParams");c.attr("disabled","disabled");var e=a.parseJSON(a.ajax({url:d.data.url,dataType:"json",data:d.data,async:!0,success:function(e){var f=e.length;if(e.length===0){c.hide();return}d.keepFirstOption===!0?c.find("option:gt(0)").remove():d.keepLastOption===!0?c.find("option:lt("+(c.find("option").length-1)+")").remove():c.find("option").remove();for(var g=0;g<f;g++)c.append("<option value="+e[g][d.valueProperty]+">"+e[g][d.labelProperty]+"</option>");if(d.defaultValue!==""){c.find("option:selected").removeAttr("selected");c.find("option[value="+d.defaultValue+"]").attr("selected","selected")}c.removeAttr("disabled");c.show();if(d.subSelect!==null&&d.subSelect.length>0){var h=d.subSelect;h.jdRemoteSelect({autoLoad:!1});h.hide();c.bind("change",function(c){c.preventDefault();var d=a(c.target),e=a.data(h[0],"jdRemoteSelectParams").data[d.attr("name")]=d.val();b.loadData.apply(h,[])});if(d.defaultValue!=undefined&&d.defaultValue!=""){a.data(h[0],"jdRemoteSelectParams")&&(a.data(h[0],"jdRemoteSelectParams").data[c.attr("name")]=c.val());b.loadData.apply(h,[])}}}}))},set:function(b,c){var d=a(this),e=d.jdRemoteSelectParams;e[b]=c},get:function(b){var c=a(this),d=c.jdRemoteSelectParams;return d[b]}};a.fn.jdRemoteSelect=function(c){if(b[c])return b[c].apply(this,Array.prototype.slice.call(arguments,1));if(typeof c=="object"||!c)return b.init.apply(this,arguments);a.error("Method "+c+" does not exist on jQuery.tooltip")}})(jQuery);